Imports GrowthWare.Framework.BusinessLogicLayer
Imports GrowthWare.Framework.Common
Imports GrowthWare.Framework.Enumerations
Imports GrowthWare.Framework.ModelObjects
Imports System.Web

Namespace Utilities

	''' <summary>
	''' SecurityEntityUtility serves as the focal point for any web application needing to utiltize the GrowthWare framework.
	''' Web needs such as caching are handeled here
	''' </summary>
	Public Class SecurityEntityUtility

		Private m_ProfileContextName As String = "ContextSecurityEntityProfile"

		Private m_DefaultProfile As MSecurityEntityProfile = Nothing

		''' <summary>
		''' Creates and returns MSecurityEntityProfile populated with information from the
		''' configuration file.
		''' </summary>
		''' <returns>MSecurityEntityProfile</returns>
		Public ReadOnly Property GetDefaultProfile As MSecurityEntityProfile
			Get
				If m_DefaultProfile Is Nothing Then
					Dim mDefaultProfile As MSecurityEntityProfile = New MSecurityEntityProfile()
					mDefaultProfile.Id = ConfigSettings.DefaultSecurityEntityID
					mDefaultProfile.DAL = ConfigSettings.DAL
					mDefaultProfile.DALNamespace = ConfigSettings.DAL_Namespace(mDefaultProfile.DAL)
					mDefaultProfile.DALAssemblyName = ConfigSettings.DAL_AssemblyName(mDefaultProfile.DAL)
					mDefaultProfile.ConnectionString = ConfigSettings.ConnectionString(mDefaultProfile.DAL)
					m_DefaultProfile = mDefaultProfile
				End If
				Return m_DefaultProfile
			End Get
		End Property

		''' <summary>
		''' Returns the current MSecurityEntityProfile from context.  If one is not found in context then 
		''' the default values from the config file will be returned.
		''' </summary>
		''' <returns>MSecurityEntityProfile</returns>
		Public ReadOnly Property GetCurrentProfile() As MSecurityEntityProfile
			Get
				Dim mRetProfile As MSecurityEntityProfile = Me.GetDefaultProfile()
				If Not HttpContext.Current Is Nothing Then
					If (Not HttpContext.Current.Items(m_ProfileContextName) Is Nothing) Then
						mRetProfile = CType(HttpContext.Current.Items(m_ProfileContextName), MSecurityEntityProfile)
					End If
				End If
				Return mRetProfile
			End Get
		End Property
	End Class
End Namespace
