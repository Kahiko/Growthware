using System;
using System.Collections;
using System.Data;
using GrowthWare.Framework.Model.Enumerations;
using GrowthWare.Framework.Model.Profiles.Base.Interfaces;
using System.Collections.Generic;
using System.Collections.ObjectModel;

namespace GrowthWare.Framework.Model.Profiles.Base
{
	/// <summary>
	/// The MBaseSecurity is a abstract class that when inherited will add 4 types of roles
	/// to your class/object.  After you have inherited the class pass a data row to the SecurityInit sub 
	/// to populate the roles.
	/// </summary>
	/// <remarks>
	/// Currently there are 4 permission roles and they are Add, Edit, View, Delete.  
	/// If you would like to extend this class do so by inheriting this class and adding your
	/// own types of roles say Moderate if your writing some sort of formum type of class.
	/// Any of the objects you create should now inherit your class and will now have all of the 
	/// roles from this class as well as the ones for yours.
	///</remarks>
	public abstract class MSecurity : MProfile, ISecurityInfo
	{
		private Collection<string> m_AssignedAddRoles = new Collection<string>();
		private Collection<string> m_AssignedDeleteRoles = new Collection<string>();
		private Collection<string> m_AssignedEditRoles = new Collection<string>();
		private Collection<string> m_AssignedViewRoles = new Collection<string>();

		private Collection<string> m_DerivedAddRoles = new Collection<string>();
		private Collection<string> m_DerivedDeleteRoles = new Collection<string>();
		private Collection<string> m_DerivedEditRoles = new Collection<string>();
		private Collection<string> m_DerivedViewRoles = new Collection<string>();
		private string m_PermissionColumn = "PERMISSIONS_SEQ_ID";

		private string m_RoleColumn = "ROLE";

		/// <summary>
		/// Initialize orverloads and calles mybase.init to will populate the Add, Delete, Edit, and View role properties.
		/// </summary>
		/// <param name="DRowSecurity">A data row that must contain two columns ("PERMISSIONS_SEQ_ID","ROLE")</param>
		/// <param name="DetailRow">A data row that contains base information</param>
		/// <remarks></remarks>
		virtual protected void Initialize(DataRow DetailRow, DataRow[] DRowSecurity)
		{
			base.Initialize(ref DetailRow);
			setDerivedRole(DRowSecurity, RoleType.AddRole);
			setDerivedRole(DRowSecurity, RoleType.DeleteRole);
			setDerivedRole(DRowSecurity, RoleType.EditRole);
			setDerivedRole(DRowSecurity, RoleType.ViewRole);
		}

		/// <summary>
		/// Return assigned roles associated with the "Add" permission.
		/// </summary>
		public Collection<string> AssignedAddRoles
		{
			get { return m_AssignedAddRoles; }
		}

		/// <summary>
		/// Return roles associated with the "Add" permission.
		/// </summary>
		public Collection<string> DerivedAddRoles
		{
			get { return m_DerivedAddRoles; }
		}

		/// <summary>
		/// Return assigned roles associated with the "Delete" permission.
		/// </summary>
		public Collection<string> AssignedDeleteRoles
		{
			get { return m_AssignedDeleteRoles; }
		}

		/// <summary>
		/// Return roles associated with the "Delete" permission.
		/// </summary>
		public Collection<string> DerivedDeleteRoles
		{
			get { return m_DerivedDeleteRoles; }
		}

		/// <summary>
		/// Return roles associated with the "Edit" permission.
		/// </summary>
		public Collection<string> AssignedEditRoles
		{
			get { return m_AssignedEditRoles; }
		}

		/// <summary>
		/// Return roles associated with the "Edit" permission.
		/// </summary>
		public Collection<string> DerivedEditRoles
		{
			get { return m_DerivedEditRoles; }
		}

		/// <summary>
		/// Return assigned roles associated with the "View" permission.
		/// </summary>
		public Collection<string> AssignedViewRoles
		{
			get { return m_AssignedViewRoles; }
		}

		/// <summary>
		/// Return roles associated with the "View" permission.
		/// </summary>
		public Collection<string> DerivedViewRoles
		{
			get { return m_DerivedViewRoles; }
		}

		/// <summary>
		/// Represents the permission column name.
		/// </summary>
		public string PermissionColumn {
			get { return m_PermissionColumn; }
			set { m_PermissionColumn = value.Trim(); }
		}

		/// <summary>
		/// Represents the role column name.
		/// </summary>
		public string RoleColumn {
			get { return m_RoleColumn; }
			set { m_RoleColumn = value.Trim(); }
		}

		/// <summary>
		/// Populates the given permissions roles.
		/// </summary>
		/// <param name="roles">Array of DataRows</param>
		/// <param name="roleType">Enum RoleType</param>
		private void setDerivedRole(DataRow[] roles, RoleType roleType)
		{
			foreach(DataRow row in roles)
			{
				if(!Convert.IsDBNull(row[m_PermissionColumn]))
				{
					if(!Convert.IsDBNull(row[m_RoleColumn])) 
					{
						switch(roleType)	
						{
							case RoleType.AddRole:
								m_DerivedAddRoles.Add(row[m_RoleColumn].ToString());
								break;
							case RoleType.DeleteRole:
								m_DerivedDeleteRoles.Add(row[m_RoleColumn].ToString());
								break;
							case RoleType.EditRole:
								m_DerivedEditRoles.Add(row[m_RoleColumn].ToString());
								break;
							case RoleType.ViewRole:
								m_DerivedViewRoles.Add(row[m_RoleColumn].ToString());
								break;
							default:
								break;
						}
					}
				}
			}
		}

		/// <summary>
		/// Populates all permissions.
		/// </summary>
		/// <param name="SecurityRows">DataRowCollection containing all derived roles for all permissions</param>
		protected void PopulatePermissions(DataRowCollection SecurityRows)
		{
			throw new NotImplementedException();
		}
	}
}
